{# templates/admin/estadisticas.html.twig #}
{% extends 'frontend.html.twig' %}

{% block title %}Estadísticas
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('css/admin.css') }}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<style>
		.chart-card {
			margin: 20px 0;
			padding: 20px;
			background: #fff;
			border-radius: 10px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease-in-out;
		}
		.chart-card:hover {
			transform: translateY(-10px);
		}
		.chart-card h2 {
			margin-bottom: 20px;
			font-size: 1.5rem;
			color: #333;
		}
		.chart-description {
			font-size: 0.9rem;
			color: #666;
			margin-top: 10px;
			text-align: center;
		}
		@media(min-width: 768px) {
			.chart-card {
				margin: 40px 0;
			}
		}
	</style>
{% endblock %}

{% block body %}
	{% include 'nav.html.twig' %}
	<section class="container-fluid container-admin min-vh-100">
		<a href="{{ path('app_admin') }}" class="btn btnVolverAdmin">
			<i class="fas fa-arrow-left"></i>
			Volver al Menú Administrador
		</a>
		<h1 class="text-center my-5">Estadísticas</h1>
		{% include 'mensajesFlash.html.twig' %}

		<div class="container">
			<div class="row">
				<div class="col-12 col-lg-6">
					<div class="chart-card">
						<h2>Canciones más reproducidas</h2>
						<canvas id="mostPlayedSongsChart"></canvas>
						<p class="chart-description">Esta gráfica muestra las canciones que han sido más reproducidas en la plataforma.</p>
					</div>
				</div>
				<div class="col-12 col-lg-6">
					<div class="chart-card">
						<h2>Distribución de Géneros Musicales</h2>
						<canvas id="songsByGenreChart"></canvas>
						<p class="chart-description">Esta gráfica muestra la distribución de canciones por género musical.</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-12 col-lg-6">
					<div class="chart-card">
						<h2>Eventos más populares</h2>
						<canvas id="mostPopularEventsChart"></canvas>
						<p class="chart-description">Esta gráfica muestra los eventos que han tenido más asistentes.</p>
					</div>
				</div>
				<div class="col-12 col-lg-6">
					<div class="chart-card">
						<h2>Usuarios más activos</h2>
						<canvas id="mostActiveUsersChart"></canvas>
						<p class="chart-description">Esta gráfica muestra los usuarios más activos en términos de interacciones.</p>
					</div>
				</div>
			</div>
		</div>
	</section>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function () { // Canciones más reproducidas
var ctx1 = document.getElementById('mostPlayedSongsChart').getContext('2d');
var mostPlayedSongsChart = new Chart(ctx1, {
type: 'bar',
data: {
labels: {{ mostPlayedSongs|map(cancion => cancion.titulo)|json_encode|raw }},
datasets: [
{
label: 'Reproducciones',
data: {{ mostPlayedSongs|map(cancion => cancion.numeroReproducciones)|json_encode|raw }},
backgroundColor: 'rgba(75, 192, 192, 0.2)',
borderColor: 'rgba(75, 192, 192, 1)',
borderWidth: 1
}
]
},
options: {
responsive: true,
scales: {
y: {
beginAtZero: true
}
},
plugins: {
title: {
display: true,
text: 'Canciones más reproducidas'
}
}
}
});

// Distribución de Géneros Musicales
var ctx2 = document.getElementById('songsByGenreChart').getContext('2d');
var songsByGenreChart = new Chart(ctx2, {
type: 'pie',
data: {
labels: {{ songsByGenre|map(genre => genre.generoMusical)|json_encode|raw }},
datasets: [
{
label: 'Distribución de Géneros',
data: {{ songsByGenre|map(genre => genre.count)|json_encode|raw }},
backgroundColor: [
'rgba(255, 99, 132, 0.2)',
'rgba(54, 162, 235, 0.2)',
'rgba(255, 206, 86, 0.2)',
'rgba(75, 192, 192, 0.2)',
'rgba(153, 102, 255, 0.2)',
'rgba(255, 159, 64, 0.2)'
],
borderColor: [
'rgba(255, 99, 132, 1)',
'rgba(54, 162, 235, 1)',
'rgba(255, 206, 86, 1)',
'rgba(75, 192, 192, 1)',
'rgba(153, 102, 255, 1)',
'rgba(255, 159, 64, 1)'
],
borderWidth: 1
}
]
},
options: {
responsive: true,
plugins: {
legend: {
position: 'top'
},
title: {
display: true,
text: 'Distribución de Géneros Musicales'
}
}
}
});

// Eventos más populares
var ctx3 = document.getElementById('mostPopularEventsChart').getContext('2d');
var mostPopularEventsChart = new Chart(ctx3, {
type: 'bar',
data: {
labels: {{ mostPopularEvents|map(evento => evento.nombre)|json_encode|raw }},
datasets: [
{
label: 'Asistentes',
data: {{ mostPopularEvents|map(evento => evento.numeroAsistentes)|json_encode|raw }},
backgroundColor: 'rgba(153, 102, 255, 0.2)',
borderColor: 'rgba(153, 102, 255, 1)',
borderWidth: 1
}
]
},
options: {
responsive: true,
scales: {
y: {
beginAtZero: true
}
},
plugins: {
title: {
display: true,
text: 'Eventos más populares'
}
}
}
});

// Usuarios más activos
var ctx4 = document.getElementById('mostActiveUsersChart').getContext('2d');
var mostActiveUsersChart = new Chart(ctx4, {
type: 'bar',
data: {
labels: {{ mostActiveUsers|map(user => user.nombre ~ ' ' ~ user.apellidos)|json_encode|raw }},
datasets: [
{
label: 'Interacciones',
data: {{ mostActiveUsers|map(user => user.favoritos|length + user.eventos|length)|json_encode|raw }},
backgroundColor: 'rgba(255, 159, 64, 0.2)',
borderColor: 'rgba(255, 159, 64, 1)',
borderWidth: 1
}
]
},
options: {
responsive: true,
scales: {
y: {
beginAtZero: true
}
},
plugins: {
title: {
display: true,
text: 'Usuarios más activos'
}
}
}
});
});
	</script>
{% endblock %}
